<!doctype linuxdoc system>

<!-- This is the User's Guide for Grace -->


<article>

<title>Grace User's Guide (v0.6 - for Grace-5.1.0)
<author>by the Grace Team
<date>20.02.2000
<abstract>
  This document explains the usage of
  <bf>Grace</bf>, a WYSIWYG 2D plotting tool for scientific data.
</abstract>

<toc>

<!-- **************************************** -->
<sect>Introduction
<p>

<sect1>What is Grace?
  <p>
     Grace is a WYSIWYG tool to make two-dimensional plots of scientific
     data. It runs under various (if not all) flavors of Unix with
     X11 and Motif (LessTif). It also runs under VMS, OS/2, and Windows
     (95/98/NT). Its capabilities are roughly similar to GUI-based
     programs like Sigmaplot or Microcal Origin plus script-based
     tools like Gnuplot or Genplot. Its strength lies in the fact
     that it combines the convenience of a graphical user interface
     with the power of a scripting language which enables it to do
     sophisticated calculations or perform automated tasks.

     Grace is derived from Xmgr (a.k.a. ACE/gr), originally written by
     Paul Turner.

     From version number 4.00, the development was taken over by a
     team of volunteers under the coordination of Evgeny Stambulchik.
     You can get the newest information about Grace and download the
     latest version at the <url
     url="http://plasma-gate.weizmann.ac.il/Grace/" name="Grace home page">.

     When its copyright was changed to GPL, the name was changed to Grace,
     which stands for ``GRaphing, Advanced Computation and Exploration of
     data'' or ``Grace Revamps ACE/gr''. The first version of Grace available
     is named 5.0.0, while the last public version of Xmgr has the version
     number 4.1.2.

     Paul still maintains and develops a non-public version of Xmgr for
     internal use.

<sect1>Copyright statement
  <p>

<tscreen><verb>
Copyright (&copy;) 1991-1995 Paul J Turner, Portland, OR
Copyright (&copy;) 1996-2000 Grace Development Team

Maintained by Evgeny Stambulchik


                         All Rights Reserved

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
</verb></tscreen>

   <p>
     For certain libraries required to build Grace
     (which are therefore even included in a suitable version)
     there may be different Copyright/License statements. Though their
     License may by chance match the one used for Grace,
     the Grace Copyright holders can not influence or change them.

   <p>
   <table LOC=htbp>
     <tabular CA="ll">
       <hline>
       Package    |  License  @
       <hline>
       cephes     |  Free     @
       T1lib      |  LGPL     @
       Xbae       |  BSD-like @
       Tab        |  BSD-like @
       <hline>
     </tabular>
     <caption>
       Licenses
     </caption>
   </table>
 <P>

<sect1>Comments and bug reports
  <p>


<!-- **************************************** -->
<sect>Installation guide
  <p>

  <sect1>Installing from sources
    <p>
      <enum>
        <item> Configuration <label id="configuration">
        <itemize>
          <item> Requirements.
                 Grace usually compiles out of the box in a regular Unix-like
                 environment. You need an ANSI C compiler (gcc is just fine),
                 the X11R5 or above libraries and headers, and Motif-1.2 or
                 above.
                 If you want to compile your own changes to certain parts of
                 Grace, you will need a parser generator (<tt/yacc/ or, better,
                 <tt/bison/).
          <item> Extra libraries. Some features will be available only if
                 additional libraries are installed. Those are:
            <itemize>
              <item> The JPEG backend needs the IJG's
                     (<url name="JPEG library" url="ftp://ftp.uu.net/graphics/jpeg/">),
                     version 6.x.
              <item> The PNG backend needs
                     the (<url name="libpng" url="http://www.cdrom.com/pub/png/">)
                     library (version 0.96 or above).
              <item> The PDF driver requires the PDFlib library of Thomas
                     Merz to be installed, which is available
                     <url name="here" url="http://www.pdflib.com/">, version
                     3.00 or above.
              <item> If your computer has the FFTW library installed when
                     Grace is compiled, Grace will link itself to this, and
                     drop all conventional FFT's and DFT's. All transforms
                     will be routed through this package. Note that there is
                     then no difference between pushing the "FFT" button and
                     the "DFT" button, except that FFT will complain if the
                     length isn't a power of 2, and DFT will not.

                     For more information on this package, see the 
                     <url name="FFTW Home page" url="http://www.fftw.org">.
                     In short, this package allows one to do non-power-of-2
                     length FFT's along with the normal ones.  It seems to work
                     very efficiently for any set length which factors into 2^a
                     3^b 5^c 7^d for integer a, b, c, d. The great feature here
                     is that set lengths which are powers of 10 (e.g. 1000,
                     10000) and integer multiples of these (500, 2000, 2500,
                     5000, etc.) can be computed with no significant penalty
                     (maybe 20%) over power-of-2 transforms. Very often, real
                     datasets come in these sizes, and not in powers of 2.
              <item> In order to read/write sets in the NetCDF data format, you
                     will also need the <url name="NetCDF libraries"
                     url="http://unidata.ucar.edu/packages/netcdf/index.html">.
            </itemize>
          <item> Decide whether you want to compile in a separate place (thus
                 leaving the source tree pristine). You most probably would
                 want it if compiling Grace for more than one OS and keeping
                 the sources in a central shared (e.g. via NFS) location.
                 If you don't need it, skip the rest of this paragraph and go
                 right to the next step. Otherwise, assuming the sources are
                 in <tt>/usr/local/src/grace-x.y.z</tt> and the compilation
                 will be performed in <tt>/tmp/grace-obj</tt>, do the following:
                 <verb>
  % mkdir /tmp/grace-obj
  % cd /tmp/grace-obj
  % /usr/local/src/grace-x.y.z/ac-tools/shtool mkshadow \
    /usr/local/src/grace-x.y.z .
                 </verb>
          <item> The <tt>configure</tt> shell script attempts to guess correct
          values for various system-dependent variables used during
          compilation. It uses those values to create <tt>Make.conf</tt> in the
          top directory of the package. It also create <tt>config.h</tt> file
          containing system-dependent definitions. Finally, it creates a shell
          script <tt>config.status</tt> that you can run in the future to
          recreate the current configuration, a file <tt>config.cache</tt> that
          saves the results of its tests to speed up reconfiguring, and a file
          <tt>config.log</tt> containing compiler output (useful mainly for
          debugging <tt>configure</tt>). If at some point <tt>config.cache</tt>
          contains results you don't want to keep, you may remove or edit it.
          <item> Run <tt>./configure --help</tt>
                 to get list of additional switches specific to Grace
          <item> Run <tt>./configure &lt;options&gt;</tt>. Just an example:
                 <verb>
  % ./configure --enable-grace-home=/opt/grace 
    --enable-extra-incpath=/usr/local/include:/opt/include \
    --enable-extra-ldpath=/usr/local/lib:/opt/lib --prefix=/usr
                 </verb>
                 would use <tt>/usr/local/include</tt> and
                 <tt>/opt/include</tt> in addition to the default include path
                 and <tt>/usr/local/lib</tt> and <tt>/opt/lib</tt> in addition
                 to the default ld path. As well, all stuff would be put under
                 the /opt/grace directory and soft links made to
                 <tt>/usr/bin</tt>, <tt>/usr/lib</tt> and <tt>/usr/include</tt>.
                   <p>
                 <bf>Note</bf>: If you change one of the
                 <tt>--enable-extra-incpath</tt> or
                 <tt>--enable-extra-ldpath</tt> options from one run of
                 configure to another, remember to delete the
                 <tt>config.cache</tt> file!!!
        </itemize>
        <item> Compilation
        <itemize>
          <item> Issue <tt>make</tt>
                   <p>
                 If something goes wrong, try to see if the problem has been
                 described already in the <bf>Grace FAQ</bf> (in the
                 <tt>doc</tt> directory).
        </itemize>
        <item> Testing
    
        <itemize>
          <item> <tt>make tests</tt>
                   <p>
                  This will give you a slide show demonstrating some nice
                  features of Grace.
        </itemize>
        <item> Installation
        <itemize>
          <item> <tt>make install</tt>
          <item> <tt>make links</tt>
                   <p>
                 The later (optional) step will make soft links from some files
                 under the Grace home directory to the system-wide default
                 locations (can be changed by the <tt>--prefix</tt> option
                 during the configuration, see above).
        </itemize>
      </enum>

  <sect1>Binary installation
    <p>
       <enum>
       <item> Getting pre-built packages
       <item> Installation
       <item> Running tests
       </enum>

  <sect1>Alternative packaging schemes (RPM, ...)
    <p>
      
      Not written yet...


<!-- **************************************** -->
<sect>Getting started
  <p>

  For a jump-in start, you can browse the demos ("Help/Examples" menu tree).
  Also, read the <url name="Tutorial" url="Tutorial.html">.

  <sect1>General concepts
    <p>

      <sect2>Project files <label id="project-file">
	<p>

          A project file contains all information necessary to restore a plot
          created by Grace, as well as some of preferences. Each plot is
          represented on a single page, but may have an unlimited number of
          graphs.

      <sect2>Graphs <label id="graph">
	<p>

          A graph consists of (every element is optional): a graph frame, axes,
          a title and a subtitle, a number of sets and additional annotative
          objects (time stamp string, text strings, lines, boxes and ellipses).

          The graph type can be any of:
          <itemize>
             <item> XY Graph
             <item> XY Chart
             <item> Polar Graph
             <item> Fixed Graph
             <item> Pie chart
          </itemize>

      <sect2>Sets <label id="sets">
	<p>

	  A set is a way of representing numerical data (datasets). It consists
          of a pointer to a dataset plus a collection of parameters describing
          the visual appearance of the data (like color, line dash pattern etc).

          The set type can be any of the following:
        
        <p>
        
          <table LOC=htbp>
          <tabular CA="lcl">
            <hline>
            Set type   | # of num. cols | Description              @
            <hline>
            XY         | 2 | An X-Y scatter and/or line plot, plus 
                             (optionally) an annotated value       @
            XYDX       | 3 | Same as XY, but with error bars
                             (either one- or two-sided) along
                              X axis                               @
            XYDY       | 3 | Same as XYDX, but error bars are
                             along Y axis                          @
            XYDXDX     | 4 | Same as XYDX, but left and right error
                             bars are defined separately           @
            XYDYDY     | 4 | Same as XYDXDX, but error bars are
                             along Y axis @
            XYDXDY     | 4 | Same as XY, but with X and Y error bars
                             (either one- or two-sided)            @
            XYDXDXDYDY | 6 | Same as XYDXDY, but left/right and 
                             upper/lower error bars are defined
                             separately                            @
            BAR        | 2 | Same as XY, but vertical bars are used
                             instead of symbols                    @
            BARDY      | 3 | Same as BAR, but with error bars
                             (either one- or two-sided) along
                              Y axis                               @
            BARDYDY    | 4 | Same as BARDY, but lower and upper
                             error bars are defined separately     @
            XYHILO     | 5 | Hi/Low/Open/Close plot                @
            XYZ        | 3 | Same as XY; makes no sense unless the
                             annotated value is Z                  @
            XYR        | 3 | X, Y,  Radius. Only allowed in Fixed
                             graphs                                @
            XYSIZE     | 3 | Same as XY, but symbol size is
                             variable                              @
            XYCOLOR    | 3 | X, Y, color index (of the symbol fill)@
            XYCOLPAT   | 4 | X, Y, color index, pattern index
                             (currently used for Pie charts only)  @
            XYVMAP     | 4 | Vector map                            @
            XYBOXPLOT  | 6 | Box plot (X, median, uper/lower limit,
                             upper/lower whisker)                  @
            <hline>
          </tabular>
          <caption>
            Set types
          </caption>
          </table>
          
        <p>

          Not all set types, however, can be plotted on any graph type. The
          following table summarizes it:

        <p>

          <table LOC=htbp>
          <tabular CA="lccccc">
            <hline>
            Set type          | XY Graph | XY Chart | Fixed | Polar | Pie @
            <hline>
            XY                |     +    |    +     |   +   |   +   |  +  @
            XYDX              |     +    |    -     |   +   |   -   |  -  @
            XYDY              |     +    |    +     |   +   |   -   |  -  @
            XYDXDX            |     +    |    -     |   +   |   -   |  -  @
            XYDYDY            |     +    |    +     |   +   |   -   |  -  @
            XYDXDY            |     +    |    -     |   +   |   -   |  -  @
            XYDXDXDYDY        |     +    |    -     |   +   |   -   |  -  @
            BAR               |     +    |    +     |   +   |   -   |  -  @
            BARDY             |     -    |    +     |   -   |   -   |  -  @
            BARDYDY           |     -    |    +     |   -   |   -   |  -  @
            XYHILO            |     +    |    -     |   -   |   -   |  -  @
            XYZ               |     +    |    -     |   +   |   -   |  -  @
            XYR               |     -    |    -     |   +   |   -   |  -  @
            XYSIZE            |     +    |    +     |   +   |   +   |  -  @
            XYCOLOR           |     +    |    +     |   +   |   +   |  +  @
            XYCOLPAT          |     -    |    -     |   -   |   -   |  +  @
            XYVMAP            |     +    |    -     |   +   |   -   |  -  @
            XYBOXPLOT         |     +    |    -     |   -   |   -   |  -  @
            <hline>
          </tabular>
          <caption>
            Graph/Set type connection
          </caption>
          </table>


      <sect2>Datasets <label id="datasets">
	<p>

          A dataset is a collection of points with x and y coordinates, up to
          four optional data values (which, depending on the set type, can be
          displayed as error bars or like) and one optional character string.

      <sect2>Regions <label id="regions">
	<p>

          Regions are sections of the graph defined by the interior or exterior
          of a polygon, or a half plane defined by a line. Regions are used to
          restrict data transformations to a geometric area occupied by region.

      <sect2>Real Time Input <label id="RTI">
	<p>

          Real Time Input refers to the ability Grace has to be
          fed in real time by an external program. The Grace
          process spawned by the driver program is a full featured
          Grace process: the user can interact using the GUI at the
          same time the program sends data and commands. The process
          will adapt itself to the incoming data rate.

      <sect2>Hotlinks <label id="hotlinks">
	<p>

          Hotlinks are sources containing varying data. Grace can be
          instructed a file or a pipe is a hotlink in which case it
          will provide specific commands to refresh the data on a
          mouse click (a later version will probably allow automatic
          refresh).

      <sect2>File formats <label id="files-formats">
	<p>

          Grace understands several input files formats. The most
          basic one is ASCII text files containing space and comma
          separated columns of data. The data fields can be either
          numeric (Fortran 'd' and 'D' exponent markers are supported)
          or alphanumeric (with or without quotes). Several calendar
          date formats are recognized automatically and you can
          specify your own reference for numeric dates formats. Grace also
          has a command language (see <ref id="command-interpreter"
          name="command interpreter">), you can include commands in
          data files using lines having "@" as their first non-blank
          character. Depending on configuration, Grace can also read
          NetCDF files (see <ref id="configuration" name="configuration">).

      <sect2>Devices<label id="devices">
	<p>
          Grace allows the user to choose between several output
          devices to produce its graphics. The current list of
          supported devices is:

          <itemize>
          <item> X11
          <item> PostScript (level 1 and level 2)
          <item> EPS
          <item> Metafile (which is Grace format, used at the moment mostly
                 for debugging purposes)
          <item> MIF (Maker Interchange Format used by FrameMaker)
          <item> SVG (Scalable Vector Graphics, a language for describing
                 two-dimensional vector and mixed vector/raster graphics
                 in XML)
          <item> PDF (depends on extra libraries,
                      see <ref name="configuration" id="configuration">)
          <item> PNM
          <item> JPEG (depends on extra libraries,
                      see <ref name="configuration" id="configuration">)
          <item> PNG (depends on extra libraries,
                      see <ref name="configuration" id="configuration">)
          </itemize>

        <p>
          Note that Grace no longer supports GIF due to
          the copyright policy of Unisys. Grace can also be
          instructed to launch conversion programs automatically
          based on file name. As an example you can produce MIF
          (FrameMaker Interchange Format) or Java applets using
          pstoedit, or almost any image format using the netpbm suite
          (see the <url name="FAQ" url="FAQ.html">).

      <sect2>Magic path<label id="magic-path">
	<p>
        In many cases, when Grace needs to access a file given with a
        relative <tt>pathname</tt>, it searches for the file along the
        following path:
        <tt>./pathname:./.grace/pathname:~/.grace/pathname:$GRACE_HOME/pathname</tt>

      <sect2>Dynamic modules<label id="dynamic-modules">
	<p>
        Grace can access external functions present in either system
        or third-party shared libraries or modules specially compiled
        for use with it. The term dynamic refers to the possibility
        Grace has to open the library at run time to find the code of
        the external function, there is no need to recompile Grace
        itself (the functions already compiled in Grace are
        "statically linked").

  <sect1>Invocation
    <p>

      <sect2>Operational mode
        <p>

          With respect to the user interface, there are three modes of
          operation that Grace can be invoked in. The full-featured GUI-based
          version is called <tt>xmgrace</tt>. A batch-printing version is
          called <tt>gracebat</tt>. A command-line interface mode is called
          <tt>grace</tt>. Usually, a single executable is called in all cases,
          with two of the three files being (symbolic) links to a "real" one.

      <sect2>Command line options
        <p>
          <descrip>
          <tag> -arrange <it>rows</it> <it>cols</it> </tag>
                Arrange the graphs in a grid rows by cols

          <tag> -autoscale <it>x|y|xy</it> </tag>
                Override any parameter file settings

          <tag> -batch <it>batch_file</it> </tag>
                Execute batch_file on start up

          <tag> -block <it>block_data</it> </tag>
                Assume data file is block data

          <tag> -bxy <it>x:y:etc.</it> </tag>
                Form a set from the current block data set using the current set
                type from columns given in the argument

          <tag> -cols <it>gcols</it> </tag>
                Arrange graphs in gcols columns

          <tag> -datehint <it>iso|european|us|days|seconds|nohint</it> </tag>
                Set the hint for dates analysis

          <tag> -dpipe <it>descriptor</it> </tag>
                Read data from descriptor (anonymous pipe) on startup

          <tag> -fixed <it>width</it> <it>height</it> </tag>
                Set canvas size fixed to width*height

          <tag> -free </tag> Use free page layout

          <tag> -graph <it>graph_number</it> </tag>
                Set the current graph number

          <tag> -graphtype <it>graph_type</it> </tag>
                Set the type of the current graph

          <tag> -hardcopy </tag>
                No interactive session, just print and quit

          <tag> -hdevice <it>hardcopy_device_name</it> </tag>
                Set default hardcopy device

          <tag> -install </tag>
                Install private colormap

          <tag> -legend <it>load</it> </tag>
                Turn the graph legend on

          <tag> -log <it>x|y|xy</it> </tag>
                Set the axis scaling of the current graph to logarithmic

          <tag> -logwindow </tag>
                Open the log window

          <tag> -mono </tag>
                Run Grace in monochrome mode (affects the display only)

          <tag> -noask </tag>
                Assume the answer is yes to all requests - if the operation would
                overwrite a file, Grace will do so without prompting

          <tag> -noinstall </tag>
                Don't use private colormap

          <tag> -nologwindow </tag>
                No log window, overrides resource setting

          <tag> -noprint </tag>
                In batch mode, do not print

          <tag> -nosigcatch </tag>
                Don't catch signals

          <tag> -npipe <it>file</it> </tag>
                Read data from named pipe on startup

          <tag> -nxy <it>nxy_file</it> </tag>
                Assume data file is in X Y1 Y2 Y3 ... format

          <tag> -param <it>parameter_file</it> </tag>
                Load parameters from parameter_file to the current graph

          <tag> -pexec <it>parameter_string</it> </tag>
                Interpret string as a parameter setting

          <tag> -pipe </tag>
                Read data from stdin on startup

          <tag> -printfile </tag> <it>file</it>
                Save print output to file

          <tag> -remove </tag>
                Remove data file after read

          <tag> -results <it>results_file</it> </tag>
                Write results of some data manipulations to results_file

          <tag> -rows <it>grows</it> </tag>
                Arrange graphs in grows rows

          <tag> -rvideo </tag>
                Exchange the color indices for black and white

          <tag> -saveall <it>save_file</it> </tag>
                Save all graphs to save_file

          <tag> -seed <it>seed_value</it> </tag>
                Integer seed for random number generator

          <tag> -source <it>disk|pipe</it> </tag>
                Source type of next data file

          <tag> -timer <it>delay</it> </tag>
                Set allowed time slice for real time inputs to delay ms

          <tag> -timestamp </tag> Add timestamp to plot

          <tag> -settype <it>xy|xydx|...</it> </tag>
                Set the type of the next data file

          <tag> -version </tag>
                Show the program version

          <tag> -viewport <it>xmin ymin xmax ymax</it> </tag>
                Set the viewport for the current graph

          <tag> -wd <it>directory</it> </tag>
                Set the working directory

          <tag> -world <it>xmin ymin xmax ymax</it> </tag>
                Set the world coordinates for the current graph

          <tag> -usage|-help </tag>
                This message
 
          </descrip>

  <sect1>Customization
    <p>
    <sect2>Environment variables <label id="environment-variables">
      <p>
        <itemize>
        <item> GRACE&lowbar;HOME
               <p>
               Set the location of Grace. This will be where help files,
               auxiliary programs, and examples are located. If you are unable
               to find the location of this directory, contact your system
               administrator.
               <p>
        <item> GRACE&lowbar;PRINT&lowbar;CMD
               <p>
               Print command. If the variable is defined but is an empty
               string, "Print to file" will be selected as default.
               <p>
        <item> GRACE&lowbar;EDITOR
               <p>
               The editor used for manual editing of dataset values.
               <p>
        <item> GRACE&lowbar;HELPVIEWER
               <p>
               The HTML viewer for on-line browsing of help documents
               <p>
        <item> GRACE&lowbar;FFTW&lowbar;WISDOM&lowbar;FILE and
               GRACE&lowbar;FFTW&lowbar;RAM&lowbar;WISDOM
               <p>
               These flags control behavior of the FFTW planner (see
               <ref id="fftw-tuning" name="FFTW tuning"> for detailed info)
               <p>
        </itemize>
    
    <sect2>Init file<label id="gracerc">
      <p>
        Upon start-up, Grace loads its init file, <tt>gracerc</tt>. The file
        is searched for in the magic path (see
        <ref id="magic-path" name="magic path">); once found, the rest of the
        path is ignored. It's recommended that in the <tt>gracerc</tt> file,
        one doesn't use statements which are part of a project file - such
        defaults, if needed, should be set in the default template (see 
        <ref id="default-template" name="default template">).

    <sect2>Default template<label id="default-template">
      <p>
        Whenever a new project is started, Grace loads the default template,
        <tt>templates/Default.agr</tt>. The file is searched for in the magic
        path (see  <ref id="magic-path" name="magic path">); once found, the
        rest of the path is ignored. It's recommended that in the default
        template, one doesn't use statements which are NOT part of a project
        file - such defaults, if needed, should be set in the
        <tt>gracerc</tt> (see <ref id="gracerc" name="init file">).

    <sect2>X resources
      <p>

        The following Grace-specific X resource settings are supported:

        <itemize>
        <item> XMgrace.invertDraw
               <newline>
               Use GXinvert rather than GXxor for rubber-band lines.
               If the rubber-banding for zooms and lines, etc. doesn't
               appear on the canvas, set this resource to yes.
               <newline>

        <item> XMgrace.allowDoubleClick
               <newline>
               When Yes, allow double clicks on the canvas to bring up various
               popups depending on  the location of the pointer when the double
               click occurs.
               <newline>

        <item> XMgrace.toolBar
               <newline>
               Enables button toolbar
               <newline>

        <item> XMgrace.statusBar
               <newline>
               Enables status bar
               <newline>

        <item> XMgrace.locatorBar
               <newline>
               Enables locator bar
               <newline>

       </itemize>


        It is also possible to customize menus by assigning key accelerators to
        any item.

        You'll need to derive the item's X resource name from the respective
        menu label, which is easily done following these rules:
        <itemize>
          <item> All non-alphanumeric characters are skipped
          <item> Start with lower case; each new word (if any) continues from
                 the capital letter
          <item> Add the item's type to the end - "Menu" for pulldown menus,
                 "Button" for menu buttons.
        </itemize>
        
        For example, in order to make Grace popup the Non-linear curve fitting
        by pressing Control+F, you would add the following two lines

        <tt>
          XMgrace*transformationsMenu.nonLinearCurveFittingButton.acceleratorText: Ctrl+F
          <newline>
          XMgrace*transformationsMenu.nonLinearCurveFittingButton.accelerator: Ctrl&lt;Key&gt;f
        </tt>


        to your <tt>.Xresources</tt> file (the file which is read when an X
        session starts; it could be <tt>.Xdefaults</tt>, <tt>.Xsession</tt> or
        some other file - ask your system administrator when in doubt). 

<!-- **************************************** -->
<sect>Guide to menus and popups
<p>

(Not finished yet... Read the <url name="Tutorial" url="Tutorial.html"> as well).

   <sect1> File menu <label id="file-menu">
   <p>
   The file menu contains all entries related to the input/output features of Grace.

      <sect2> New <label id="new">
      <p>
      Reset the state of Grace as if it had just started (one empty
      graph ranging from 0 to 1 along both axes). If some work has
      been done and not yet saved, a warning popup is displayed to
      allow canceling the operation.

      <sect2> Open <label id="open">
      <p>
      Open an existing <ref id="project-file" name="project file">. A
      popup is displayed that allow to browse the file system.

      <sect2> Save <label id="save">
      <p>
      Save the current work in a project file, using the name that was
      used for the last open or save. If no name has been set (i.e.,
      if the project has been created from scratch) act as <ref
      id="save-as" name="save as">.

      <sect2> Save as <label id="save-as">
      <p>
      Save the current work in a project file with a new name. A popup allows
      to browse the file system and set the name, the format to use for saving
      data points (the default value is "%16.8g"), and a textual description of
      the project. A warning is displayed if a file with the same name already
      exists.

      <sect2> Revert to saved <label id="revert-to-saved">
      <p>
      Abandon all modifications performed on the project since the
      last save. A confirmation popup is fired to allow the user
      canceling the operation.

      <sect2> Read menu <label id="read-menu">
      <p>
         <sect3> Sets <label id="read-sets">
         <p>
         Read new sets of data in a graph. A <ref id="graph-selector"
         name="graph selector"> is used to specify the graph where the
         data should go (except when reading block data, which are
         copied to graphs later on).

         Reading as "Single set" means that if the source contains
         only one column of numeric data, one set will be created
         using the indices (from 1 to the total number of points) as
         abscissas and read values as ordinates and that if the source
         contains more than one column of data, the first two numeric
         columns will be used. Reading as "NXY" means that the first
         numeric column will provide the abscissas and all remaining
         columns will provide the ordinates of several sets. Reading
         as "Block data" means all column will be read and stored and
         that another popup will allow to select the abscissas and
         ordinates at will. It should be noted that block data are
         stored as long as you do not override them by a new read. You
         can still retrieve data from a block long after having closed
         all popups, using the <ref id="set-selector" name="set
         selector">.

         The set type can be one of the predefined set presentation types
         (see <ref id="sets" name="sets">).

         The data source can be selected as "Disk" or "Pipe". In the
         first case the text in the "Selection" field is considered to
         be a file name (it can be automatically set by the file
         selector at the top of the popup). In the latter case the
         text is considered to be a command which is executed and
         should produce the data on its standard output. On systems
         that allows is, the command can be a complete sequence of
         programs glued together with pipes.

         If the source contains date fields, they should be
         automatically detected. Several formats are recognized (see
         appendix <ref id="dates" name="dates in grace">). Calendar
         dates are converted to numerical dates upon reading.
         
         The "Autoscale on read" menu controls whether, upon reading in new
         sets, which axes of the graph should be autoscaled.

         <sect3> NetCDF <label id="read-netCDF">
         <p>
         This entry exists only if Grace has been compiled with
         support for the NetCDF data format (see <ref
         id="configuration" name="configuration">).

         <sect3> Parameters <label id="read-parameters">
         <p>
         Retrieve settings previously saved.

      <sect2> Write menu <label id="write-menu">
      <p>
         <sect3> Sets <label id="write-sets">
         <p>
         Save data sets in a file. A <ref id="set-selector" name="set
         selector"> is used to specify the set to be saved. The format
         to use for saving data points can be specified (the default
         value is "%16.8g"). A warning is displayed if a file with the
         same name already exists.

         <sect3> Parameters <label id="write-parameters">
         <p>
         Save the parameters either for only the current graph or for
         all graphs.

      <sect2> Print <label id="print">
      <p>
      Print the project using the current printer settings

      <sect2> Device setup <label id="device-setup">
      <p>
      Set the properties of the printing device. Each device has its
      own set of specific options (see <ref name="Device-specific
      settings" id="device-settings">). According to the device, the
      output can be sent either directly to a printer or directed to a
      file. The global settings available for all devices are the
      sizing parameters.

      <sect2> Exit <label id="exit">
      <p>
      Exit from Grace. If some work has been done and not saved, a
      warning popup will be displayed to allow the user to cancel the
      operation.

   <sect1> Edit menu <label id="edit-menu">
   <p>
      <sect2> Data sets <label id="data-sets">
      <p>
      Using the data set popup, you can view the properties of
      datasets. This include its type, length, associated comment and
      main some statistics (min, max, mean, standard deviation). A
      horizontal scrollbar at the bottom allows to get the two last
      properties, they are not displayed by default. Also note that if
      you find some columns are too narrow to show all significant
      digits, you can drag the vertical rules using Shift+Button 2.

      <sect2> Set operations <label id="set-operations">
      <p>
      The set operations popup allows you to interact with sets as a
      whole. If you want to operate on the data ordering of the sets,
      you should use the <ref name="data set operations"
      id="data-set-operations"> popup from the Data menu. The popup
      allows you to select a source (one set within one graph) and a
      destination and perform some action upon them (copy, move,
      swap). This popup also give you a quick access to several graph
      and set selectors if you want to perform some other operation
      like hiding a graph or creating a new set from block data.

      <sect2> Arrange graphs <label id="arrange-graphs">
      <p>
      This entry fires up a popup to lay out several graphs in a
      regular grid given rows and columns. The graphs can be packed
      together (either horizontally or vertically). New graphs are
      created if needed. An important note is that reducing the number
      of graphs never delete any graphs! If you select a 6 by 3 grid
      and then reduce it to 5 by 3, you will still have 18 graphs on
      your screen, three of them looking strange in the middle of the
      other ones. This is a security feature that prevent you from
      losing data accepting too quickly a wrong setting. If you really
      want to get rid of some of the graphs, you should hide or kill
      them using any graph selector you can find around (for example
      in the set operations presented above).

      If you don't want the regular layout this arrangement gives you,
      you can change it afterwards using the mouse (select a graph and
      double click on the focus marker, see <ref id="clicks"
      name="clicks and double clicks">).

      <sect2> Overlay graphs <label id="overlay-graphs">
      <p>
      You can overlay a graph on top of another one. The main use of
      this feature is to plot several curves using different scales on
      the same (apparently) graph. The main difficulty is to be sure
      you operate on the graph you want at all times (you can hide one
      for a moment if this becomes too difficult).

      <sect2> Autoscale <label id="autoscale">
      <p>
      Using this entry, you can autoscale one graph or all graphs
      according to the specified sets only. This is useful if you need
      either to have truly comparable graphs despite every one
      contains data of different ranges, or if you want to focus your
      attention on one set only while it is displayed with other data
      in a complex graph.

      <sect2> Regions menu <label id="regions-menu">
      <p>
         <sect3> Status <label id="status">
         <p>
         This small popup only displays the current state (type and
         whether it is active or not) of the existing regions.

         <sect3> Define <label id="define">
         <p>
         You can define a new region (or redefine an existing one),
         the allowed region types are:

         <itemize>
         <item> Inside polygon
         <item> Outside polygon
         <item> Above line
         <item> Below line
         <item> Left of line
         <item> Right of line
         <item> In horizontal range
         <item> In vertical range
         <item> Out of horizontal range
         <item> Out of vertical range
         </itemize>

         A region can be either linked to the current graph only or to
         all graphs.

         <sect3> Clear <label id="clear">
         <p>
         This kills a region.

         <sect3> Report on <label id="report-on">
         <p>
         This popup reports you which sets or points are inside or
         outside of a region.

      <sect2> Hot links <label id="hot-links">
      <p>
      You can link a set to a file or a pipe using this feature. Once
      a link has been established, you can update it (i.e., read data
      again) by clicking on the update button. If you have specified a
      command (using grace language) in the corresponding text field
      of the popup, it will be executed after each update. Note that
      you can use several commands separated by ';' characters.
      <p>
      Currently, only simple XY sets can be used for hotlinks.

      <sect2> Set locator fixed point <label id="set-locator-fixed-point">
      <p>
      After having selected this menu entry, you can select a point on
      a graph that will be used as the origin of the locator display
      (just below the menu bar). The fixed point is taken into account
      only when the display type of the locator is set to [DX,DY].

      <sect2> Clear locator fixed point <label id="clear-locator-fixed-point">
      <p>
      This entry is provided to remove a fixed point set before and
      use the default again: point [0, 0].

      <sect2> Locator props <label id="locator-props">
      <p>
      The locator props popup allows you to customize the display of
      the locator, mainly its type and the format and precision of the
      display. You can use all the formats that are allowed in the
      graphs scales.

      <sect2> Preferences <label id="preferences">
      <p>
      The preferences popup allows you to set miscellaneous properties
      of your grace session, such as GUI behavior, cursor type,
      date reading hint and reference date used for calendar conversions.

   <sect1> Data menu <label id="data-menu">
   <p>
      <sect2> Data set operations <label id="data-set-operations">
      <p>
       This popup gathers all operations that are related to the
      ordering of data points inside a set or between sets. If you
      want to operate on the sets as a whole, you should use the <ref
      name="set operations" id="set-operations"> popup from the Edit
      menu. You can sort according to any coordinate (X, Y, DX, ...)
      in ascending or descending order, reverse the order of the
      points, join several sets into one, split one set into several
      others of equal lengths, or drop a range of points from a
      set. The <ref name="set selector" id="set-selector"> of the
      popup shows the number of points in each set in square brackets
      like this: G0.S0[63], the points are numbered from 0 to n-1.

      <sect2> Transformations menu <label id="transformations-menu">
      <p>
      The transformations sub-menu gives you access to all data-mining
      features of Grace.

         <sect3> Evaluate expression <label id="evaluate-expression">
         <p>
         Using evaluate expression allows you to create a set by
         applying an explicit formula to another set, or to parts of
         another set if you use regions restrictions.

         All the classical mathematical functions are available (cos,
         sin, but also lgamma, j1, erf, ...). As usual all
         trigonometric functions use radians by default but you can
         specify a unit if you prefer to say cos (x rad) or sin (3 * y
         deg). Other predefined names include pi (for the constant)
         and a, b, c and d for scratch arrays you can use to store
         data between evaluations.

         In the formula, you can use X, Y, Y1, ..., Y4 to denote any
         coordinate you like from the source set. An implicit loop
         will be used around your formula so if you say:

         <tscreen><verb>
         x = x - 4966.5
         </verb></tscreen>

         you will shift all points of your set 4966.5 units to the left.

         You can use more than one set in the same formula, like this:

         <tscreen><verb>
         y = y - 0.653 * sin (x deg) + s2.y
         </verb></tscreen>

         which means you use both X and Y from the source set but also
         the Y coordinate of set 2. Beware that the loop is a simple
         loop over the indices, all the sets you use in such an hybrid
         expression should therefore have the same number of points
         and point i of one set should really be related to point i of
         the other set. If your sets do not follow these requirements,
         you should first homogenize them using
         <ref name="interpolation" id="interpolation">.

         <sect3> Histograms <label id="histograms">
         <p>
         The histograms popup allows you to compute either standard
         or cumulative histograms from the Y coordinates of
         your data. You can select only a range using the start and
         end fields and you can specify the bin width.

         <sect3> Fourier transforms <label id="fourier-transforms">
         <p>
         This popup is devoted to direct and inverse Fourier
         transforms. The default is to perform a direct transform on
         unfiltered data and to produce a set with the index as
         abscissa and magnitude as ordinate. You can filter the input
         data window through triangular, Hanning, Welch, Hamming,
         Blackman and Parzen filters. You can load magnitude, phase or
         coefficients and use either index, frequency or period as
         abscissas. You can choose between direct and inverse Fourier
         transforms. If you specify real input data, X is assumed to
         be equally spaced and ignored; if you specify complex input
         data X is taken as the real part and Y as the imaginary part.

         If Grace was configured with the FFTW library (see <ref
         name="configuration" id="configuration">), then the DFT and
         FFT buttons really perform the same transform (so there is no
         speed-up in using FFT in this case). If you want Grace can to
         use FFTW <it>wisdom</it> files, you should set several <ref
         name="environment variables" id="environment-variables"> to
         name them.

         <sect3> Running averages <label id="running-averages">
         <p>
         The running average popup allows you to compute some values
         on a sliding window over your data. You choose both the value
         you need (average, median, minimum, maximum, standard
         deviation) and the length of the window and perform the
         operation. You can restrict the operation to the points
         belonging to (or outside of) a region.

         <sect3> Differences <label id="differences">
         <p>
         The differences popup is used to compute approximations of
         the first derivative of a function with finite
         differences. The only choice (apart from the source set of
         course) is the type of differences to use: forward, backward
         or centered.

         <sect3> Seasonal differences <label id="seasonal-differences">
         <p>
         The seasonal differences popup is used to subtract data from
         a period to data of the preceding period (namely y[i] - y[i +
         period]). Beware that the period is entered in terms of index
         in the set and not in terms of abscissa!

         <sect3> Integration <label id="integration">
         <p>
         The integration popup is used to compute the integral of a
         set and optionally to load it. The numerical value of the
         integral is shown in the text field after
         computation. Selecting "cumulative sum" in the choice item
         will create and load a new set with the integral and compute
         the end value, selecting "sum only" will only compute the end
         value.

         <sect3> Interpolation <label id="interpolation">
         <p>
         The interpolation popup is used to force the abscissas of one
         set to correspond exactly to the abscissas of another
         set. This is mainly used before performing some complex
         operations between the two sets with the <ref name="evaluate
         expression" id="evaluate-expression"> popup. Several
         interpolation methods can be used: linear, spline or Akima
         splines. Note that if the interpolated set is not wider than
         the reference set, some extremal points will be missing. You
         can check this with the number of points of each set (it
         appears in the set selectors of the popup). In this case you
         can perform a second run interpolating the reference set at
         the abscissas of the newly created set, this will remove the
         extra points.

         <sect3> Splines <label id="splines">
         <p>
         Using the splines popup you can fit a part of a set with
         cubic or Akima splines. You select which part you want to
         operate on with the start and stop fields, they are both
         expressed in abscissa units. The number of points refer to
         the spline you want to create.

         <sect3> Regression <label id="regression">
         <p>
         The regression popup can be used to fit a set against
         polynomials or some specific functions (y=A*x^B,
         y=A*exp(B*x), y=A+B*ln(x) and y=1/(A+Bx)) for which a simple
         transformation of input data can be used to apply linear
         regression formulas.

         You can load either the fitted values, the residuals or the
         function itself. Choosing to load fitted values or residuals
         leads to a set of the same length and abscissas as the
         initial set. Choosing to load the function is almost similar
         to load the fitted values except that you choose yourself the
         boundaries and the number of points. This can be used for
         example to draw the curve outside of the data sample range or
         to produce an evenly spaced set from an irregular one.

         <sect3> Non-linear fit <label id="non-linear-fit">
         <p>
         The non linear fit popup can be used for functions outside of
         the simple regression methods scope. With this popup you
         provide the expression yourself using a0, a1, ..., a9 to
         denote the fit parameters (as an example you can say y = a0 * cos
         (a1 * x + a2)). You specify a tolerance, starting values and
         optional bounds and run several steps before loading the
         results.

         The fit characteristics (number of parameters, formula, ...)
         can be saved in a file and retrieved as needed using the file
         menu of the popup.

         In the "Advanced" tab, you can additionally apply a restriction to the
         set(s) to be fitted (thus ignoring points not satisfying the
         criteria), use one of preset weighting schemes or define your own,
         and choose whether to load the fitted values, the residuals or
         the function itself. Choosing to load fitted values or residuals leads
         to a set of the same length and abscissas as the initial set. Choosing
         to load the function is almost similar to load the fitted values
         except that you choose yourself the boundaries and the number of
         points. This can be used for example to draw the curve outside of the
         data sample range or to produce an evenly spaced set from an irregular
         one.

         <sect3> Cross/auto correlation <label id="cross/auto-correlation">
         <p>
         The correlation popup can be used to compute autocorrelation
         of one set or cross correlation between two sets. You only
         select the set (or sets) and specify the maximum lag.

         <sect3> Digital filter <label id="digital-filter">
         <p>
         You can use a set as a weight to filter another set. Only the
         Y part and the length of the weighting set are important, the
         X part is ignored.

         <sect3> Linear convolution <label id="linear-convolution">
         <p>
         The convolution popup is used to ... convolve two sets. You
         only select the sets and apply.

         <sect3> Geometric transforms <label id="geometric-transforms">
         <p>
         You can rotate, scale or translate sets using the geometric
         transformations popup. You specify the characteristics of
         each transform and the application order.

         <sect3> Sample points <label id="sample-points">
         <p>
         This popup provides two sampling methods. The first one is
         to choose a starting point and a step, the second one is to
         select only the points that satisfy a boolean expression you
         specify.

         <sect3> Prune data <label id="prune-data">
         <p>
         This popup is devoted to reducing huge sets (and then saving
         both computation time and disk space).

         The interpolation method can be applied only to ordered sets:
         it is based on the assumption that if a real point and an
         interpolation based on neighboring points are closer than a
         specified threshold, then the point is redundant and can be
         eliminated.

         The geometric methods (circle, ellipse, rectangle) can be
         applied to any set, they test each point in turn and keep
         only those that are not in the neighborhood of previous
         points.
         <p>

      <sect2> Feature extraction <label id="feature-extraction">
      <p>
      Given a set of curves in a graph, extract a feature from each
      curve and use the values of the feature to provide the Y values
      for a new curve.

      <p>
      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Feature           | Description                       @
              <hline>
Y minimum |  Minimum Y value of set @
Y maximum | Maximum Y value of set @
Y average | Average Y value of set @
Y std. dev. | Standard deviation of Y values @
Y median | Median Y value @
X minimum | Minimum X value of set @
X maximum | Maximum X value of set @
X average | Average X value of set @
X std. dev. | Standard deviation of X values @
X median | Median X value @
Frequency | Perform DFT (FFT if set length a power of 2) to find largest frequency component @
Period | Inverse of above  @
Zero crossing | Time of the first zero crossing, + or - going @
Rise time | Assume curve starts at the minimum and rises to the maximum, get time to go from 10% to 90% of rise. For single exponential curves, this is 2.2*time constant @
Fall time | Assume curve starts at the maximum and drops to the minimum, get time to go from 90% to 10% of fall @
Slope | Perform linear regression to obtain slope @
Y intercept | Perform linear regression to obtain Y-intercept @
Set length | Number of data points in set @
Half maximal width | Assume curve starts from the minimum, rises to the maximum and drops to the minimum again. Determine the time for which the curve is elevated more than 50% of the maximum rise. @
Barycenter X | Barycenter along X axis @
Barycenter Y | Barycenter along Y axis @
X (Y max)    | X of Maximum Y @
Y (X max)    | Y of Maximum X @
integral     | cumulative sum @
              <hline>
      </tabular>
      <caption>
              Extractable features
      </caption>
      </table>


   <sect1> Plot menu <label id="plot-menu">
   <p>
      <sect2> Plot appearance <label id="plot-appearance">
      <p>
      The plot appearance popup let you set the time stamp properties
      and the background color of the page. The color is used outside
      of graphs and also on graphs were no specific background color
      is set. The time stamp is updated every time the project is modified.

      <sect2> Graph appearance <label id="graph-appearance">
      <p>
      The graph appearance popup can be displayed from both the plot
      menu and by double-clicking on a legend, title, or subtitle of a
      graph (see <ref name="Clicks and double clicks"
      id="clicks">). The graph selector at the top allows to choose
      the graph you want to operate on, it also allows certain common
      actions through its popup menu (see <ref name="graph selector"
      id="graph-selector">). The main tab includes the properties you
      will need more often (title for example), and other tabs are
      used to fine tune some less frequently used options (fonts,
      sizes, colors, placements).

      If you need special characters or special formatting in your
      title or subtitle, you can use grace escape sequences (the
      sequence will appear verbatim in the text field but will be
      rendered on the graph), see <ref name="typesetting"
      id="typesetting">. If you don't remember the mapping between
      alphabetic characters and the glyph you need in some specific
      fonts (mainly symbol and zapfdingbats), you can invoke the font
      tool from the text field by hitting CTRL-e. You can change fonts
      and select characters from there, they will be copied back in
      the text field when you press the "Accept" button. Beware of
      the position of the cursor as you enter text or change font in
      the font tool, the character or command will be inserted at this
      position, not at the end of the string!

      <sect2> Set appearance <label id="set-appearance">
      <p>
      The set appearance popup can be displayed from both the plot
      menu and by double-clicking anywhere in a graph (see <ref
      name="Clicks and double clicks" id="clicks">). The set selector
      at the top allows to choose the set you want to operate on, it
      also allows certain common actions through its popup menu (see
      <ref name="set selector" id="set-selector">). The main tab
      gathers the properties you will need more often (line and
      symbol properties or legend string for example), and other tabs
      are used to fine tune some less frequently used options (drop
      lines, fill properties, annotated values and error bars
      properties for example).

      You should note that despite the legend string related to
      <em/one/ set is entered in the set appearance popup, this is not
      sufficient to display it. Displaying <em/all/ legends is a graph
      level decision, so the toggle is in the main tab of the <ref
      name="graph appearance" id="graph-appearance"> popup.

      If you need special characters or special formatting in your
      legend, you can use grace escape sequences (the sequence will
      appear verbatim in the text field but will be rendered on the
      graph), see <ref name="typesetting" id="typesetting">. If you
      don't remember the mapping between alphabetic characters and the
      glyph you need in some specific fonts (mainly symbol and
      zapfdingbats), you can invoke the font tool from the text
      field by hitting CTRL-e. You can change fonts and select
      characters from there, they will be copied back in the text
      field when you press the "Accept" button. Beware of the
      position of the cursor as you enter text or change font in the
      font tool, the character or command will be inserted at this
      position, not at the end of the string!

      <sect2> Axis properties <label id="axis-properties">
      <p>
      The axis properties popup can be displayed from both the "Plot"
      menu and by double-clicking exactly on an axis (see <ref
      name="Clicks and double clicks" id="clicks">). The pulldown menu
      at the top allows to select the axis you want to operate on. The
      "Active" toggle globally activates or deactivates the axis (all
      GUI elements are insensitive for deactivated axes). The start
      and stop fields depict the displayed range. Three types of
      scales are available: linear, logarithmic or reciprocal, and
      you can invert the axis (which normally increases from left to
      right and from bottom to top).  The main tab includes the
      properties you will need more often (axis label, tick
      spacing and format for example), and other tabs are used to fine
      tune some less frequently used options (fonts, sizes, colors,
      placements, stagger, grid lines, special ticks, ...).

      If you need special characters or special formatting in your
      label, you can use grace escape sequences (the
      sequence will appear verbatim in the text field but will be
      rendered on the graph), see <ref name="typesetting"
      id="typesetting">. If you don't remember the mapping between
      alphabetic characters and the glyph you need in some specific
      fonts (mainly symbol and zapfdingbats), you can invoke the font
      tool from the text field by hitting CTRL-e. You can change fonts
      and select characters from there, they will be copied back in
      the text field when you press the "Accept" button. Beware of
      the position of the cursor as you enter text or change font in
      the font tool, the character or command will be inserted at this
      position, not at the end of the string!

      Once you have set the options as you want, you can apply
      them. One useful feature is that you can set several axes at
      once with the bottom pulldown menu (current axis, all axes
      current graph, current axis all graphs, all axes all
      graphs). Beware that you always apply the properties of all
      tabs, not only the selected one.

   <sect1> View menu <label id="view-menu">
   <p>
      <sect2> Show locator bar <label id="show-locator-bar">
      <p>
      This toggle item shows or hides the locator below the menu bar.

      <sect2> Show status bar <label id="show-status-bar">
      <p>
       This toggle item shows or hides the status string below the
       canvas.

     <sect2> Show tool bar <label id="show-tool-bar">
      <p>
      This toggle item shows or hides the tool bar at the left of the
      canvas.

      <sect2> Redraw <label id="redraw">
      <p>
      This menu item triggers a redrawing of the canvas.

      <sect2> Update all <label id="update-all">
      <p>
      This menu item causes an update of all GUI controls. Usually, everything
      is updated automatically, unless one makes modifications by entering
      commands in the <ref name="Command" id="commands"> tool.


   <sect1> Window menu <label id="window-menu">
   <p>
      <sect2> Commands <label id="commands">
      <p>
      <sect2> Point tracking <label id="point-tracking">
      <p>
      <sect2> Drawing objects <label id="drawing-objects">
      <p>
      <sect2> Font tool <label id="font-tool">
      <p>
      <sect2> Results <label id="results">
      <p>

   <sect1> Help menu <label id="help-menu">
   <p>
      <sect2> On context <label id="on-context">
      <p>
        This function is not implemented yet.

      <sect2> User's guide <label id="users-guide">
      <p>
        Browse the Grace user's guide.
      
      <sect2> Tutorial <label id="tutorial">
      <p>
        Browse the Grace tutorial.
      
      <sect2> FAQ <label id="faq">
      <p>
        Frequently Asked Questions with answers.
      
      <sect2> Changes <label id="changes">
      <p>
        The list of changes during the Grace development.
 
      <sect2> Examples <label id="examples">
      <p>
        The whole tree of submenus each loading a sample plot.
      
      <sect2> Comments <label id="comments">
      <p>
        Use this to send your suggestions or bug reports.
        
      <sect2> License terms <label id="license-terms">
      <p>
        Grace licensing terms will be displayed (GPL version 2).
      
      <sect2> About <label id="about">
      <p>
        A popup with basic info on the software, including some
        configuration details. More details can be found when running Grace
        with the "-version" command line flag.

<!-- **************************************** -->
<sect>GUI controls
  <p>
    <sect1>List selectors
       <p>
       Various selectors are available in several popups. They all display
       lists of objects (graphs, sets, ...) and can be used to perform
       simple operations on these objects (copying, deleting, ...). The
       operations are available from a popup menu that appears when pressing
       mouse button 3 on them. Depending on the required functionality, they
       may allow multiple choices or not. The following
       shortcuts are enabled (if the result of an action would contradict the
       list's selection policy, this would be ignored):
       <itemize>
         <item> Ctrl+a select all
         <item> Ctrl+u unselect all
         <item> Ctrl+i invert selection
       </itemize>

         <sect2> Graph selector <label id="graph-selector">
         <p>
         The operations that can be performed on graphs through the graph
         selector's menu popup are:
         <itemize>
           <item> focus to
           <item> hide
           <item> show
           <item> duplicate
           <item> kill
           <item> swap
           <item> create new
         </itemize>
         All this operations are not available in every instance of the
         selector. For example in the "read sets" popup only one graph can
         be selected at a time, and the swap operation is disabled.
 
         Double-clicking on a list entry will switch the focus to that graph.

         <sect2> Set selector <label id="set-selector">
         <p>
         The operations that can be performed on sets through the set
         selector are:
         <itemize>
           <item> hide
           <item> show
           <item> bring to front
           <item> send to back
           <item> duplicate
           <item> kill
           <item> kill data
           <item> swap
           <item> edit
           <itemize>
             <item> in spreadsheet
             <item> in text editor
           </itemize>
           <item> create new
           <itemize>
             <item> by formula
             <item> in spreadsheet
             <item> in text editor
             <item> from block data
           </itemize>
           <item> pack all sets
           <item> selectors operations
           <itemize>
             <item> show data-less
             <item> show hidden
             <item> select all
             <item> unselect all
             <item> invert selection
             <item> update
           </itemize>
         </itemize>


<!-- **************************************** -->
<sect>Canvas actions
  <p>

  <sect1>Hotkeys
    <p>

      When the pointer focus is on the canvas (where the graph is drawn), there
      are some shortcuts to activate several actions. They are:

      <itemize>
        <item> Ctrl &lt;Key&gt;A: Autoscale
        <item> Ctrl &lt;Key&gt;D: Delete an object
        <item> Ctrl &lt;Key&gt;L: Move current graph legend
        <item> Ctrl &lt;Key&gt;M: Move an object
        <item> Ctrl &lt;Key&gt;T: Place timestamp
        <item> Ctrl &lt;Key&gt;U: Refresh hotlinks
        <item> Ctrl &lt;Key&gt;V: Set the viewport with mouse
        <item> Ctrl &lt;Key&gt;Z: Zoom
        <item> Ctrl Alt &lt;Key&gt;L: Draw a line
        <item> Ctrl Alt &lt;Key&gt;B: Draw a box
        <item> Ctrl Alt &lt;Key&gt;E: Draw an ellipse
        <item> Ctrl Alt &lt;Key&gt;T: Write a text string
      </itemize>

  <sect1>Clicks and double clicks<label id="clicks">
    <p>

      A single click inside a graph switches focus to that graph. This is the
      default policy, but it can be changed from the "Edit/Preferences"
      popup.

    <p>

      Double clicking on parts of the canvas will invoke certain actions
      or raise some popups:
      
      <itemize>
        <item> on a focus marker: move selected viewport corner 
        <item> on an axis:  "Axis properties" popup
        <item> on a set:    "Set appearance" popup
        <item> on a legend: "Graph appearance" popup
        <item> on a (sub)title: "Graph appearance" popup
        <item> on an object (box, line, ...): a popup for editing properties of that object
      </itemize>

      The double clicking actions can be enabled/disabled from the
      "Edit/Preferences" popup.

<!-- **************************************** -->
<sect>Command interpreter <label id="command-interpreter">
  <p>

  <sect1>General notes
    <p>

      

  <sect1>Definitions
    <p>

      Not written yet...

  <sect1>Graph properties
    <p>

      Not written yet...

  <sect1>Set properties
    <p>

      Not written yet...

  <sect1>Functions and variables
    <p>

      Not written yet...

  <sect1>Procedures
    <p>

      Not written yet...

  <sect1>Device parameters
    <p>

      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command                                       | Description   @
              <hline>
              PAGE SIZE xdim, ydim                          | set page dimensions (in pp) of all devices  @
              DEVICE <it/"devname"/ PAGE SIZE xdim, ydim    | set page dimensions (in pp) of device <it/devname/  @
              DEVICE <it/"devname"/ DPI dpi                 | set device's dpi (dots per pixel) @
              DEVICE <it/"devname"/ FONT onoff              | enable/disable usage of built-in fonts for device <it/devname/ @
              DEVICE <it/"devname"/ FONT ANTIALIASING onoff | enable/disable font aliasing for device <it/devname/ @
              DEVICE <it/"devname"/ OP <it/"options"/       | set device specific options (see <ref id="device-settings" name="Device-specific settings">) @
              HARDCOPY DEVICE <it/"devname"/                | set device <it/devname/ as current hardcopy device @
              <hline>
      </tabular>
      <caption>
              <label id="device-parameters">
              Device parameters.
      </caption>
      </table>

<!-- **************************************** -->
<sect>Advanced topics
  <p>

  <sect1>Fonts
    <p>
    For all devices, Grace uses Type1 fonts. Both PFA (ascii) and PFB
    (binary) formats can be used.
    <p>
    <sect2>Font configuration
      <p>
      The file responsible for the font configurations of Grace is
      <tt>fonts/FontDataBase</tt>. The first line contains a positive integer
      specifying the number of fonts declared in that file. All remaining lines
      contain declarations of one font each, composed out of three fields:
      <enum>
        <item> Font name. The name will appear in the font selector controls.
               Also, backend devices that has built-in fonts, will be given the
               name as a font identifier.
        <item> Font fall-back. Grace will try to use this in case the real
               font is not found.
        <item> Font filename. The file with the font outline data.
      </enum>
    <p>
      Here is the default <tt>FontDataBase</tt> file:
      <tscreen><code>
14
Times-Roman             Times-Roman             n021003l.pfb
Times-Italic            Times-Italic            n021023l.pfb
Times-Bold              Times-Bold              n021004l.pfb
Times-BoldItalic        Times-BoldItalic        n021024l.pfb
Helvetica               Helvetica               n019003l.pfb
Helvetica-Oblique       Helvetica-Oblique       n019023l.pfb
Helvetica-Bold          Helvetica-Bold          n019004l.pfb
Helvetica-BoldOblique   Helvetica-BoldOblique   n019024l.pfb
Courier                 Courier                 n022003l.pfb
Courier-Oblique         Courier-Oblique         n022023l.pfb
Courier-Bold            Courier-Bold            n022004l.pfb
Courier-BoldOblique     Courier-BoldOblique     n022024l.pfb
Symbol                  Symbol                  s050000l.pfb
ZapfDingbats            ZapfDingbats            d050000l.pfb
      </code></tscreen>
    <p>

    <sect2>Font data files
    <p>
      For text rastering, three types of files are used.
      <enum>
        <item> <tt>.pfa</tt>-/<tt>.pfb</tt>-files: These contain the character
               outline descriptions. The files are assumed to be in the
               <tt>fonts/type1</tt> directory; these are the filenames
               specified in the <tt>FontDataBase</tt> configuration file.
        <item> <tt>.afm</tt>-files: These contain high-precision font metric
               descriptions as well as some extra information, such as kerning
               and ligature information for a particular font. It is assumed
               that the filename of a font metric file has same basename as the
               respective font outline file, but with the <tt>.afm</tt>
               extension; the metric files are expected to be found in the
               <tt>fonts/type1</tt> directory, too.
        <item> <tt>.enc</tt>-files: These contain encoding arrays in a special
               but simple form. They are only needed if someone wants to load
               a special encoding to reencode a font. Their place is
               <tt>fonts/enc</tt>
      </enum>
      
    <sect2>Custom fonts
      <p>
      It is possible to use custom fonts with Grace. One mostly needs to use
      extra fonts for the purpose of localization. For many European
      languages, the standard fonts supplied with Grace should contain all the
      characters needed, but encoding may have to be adjusted. This is done by
      putting a <tt>Default.enc</tt> file with proper encoding scheme into the
      <tt>fonts/enc</tt> directory. Grace comes with a few encoding files in
      the directory; more can be easily found on the Internet. (If the
      <tt>Default.enc</tt> file doesn't exist, the IsoLatin1 encoding will be
      used). Notice that for fonts having an encoding scheme in themselves
      (such as the Symbol font, and many nationalized fonts) the default
      encoding is ignored.
      <p>
      If you do need to use extra fonts, you should modify the
      <tt>FontDataBase</tt> file accordingly, obeying its format. However,
      if you are going to exchange Grace project files with other people who
      do not have the extra fonts configured, an important thing is to define
      reasonable fall-back font names.
      <p>
      For example, let us assume I use Hebrew fonts, and the configuration file
      has lines like these:
      <tscreen><code>
    ...
Courier-Hebrew              Courier                 courh___.pfa
Courier-Hebrew-Oblique      Courier-Oblique         courho__.pfa
    ...
      </code></tscreen>
      My colleague, who lives in Russia, uses Cyrillic fonts with Grace
      configured like this:
      <tscreen><code>
    ...
Cronix-Courier              Courier                 croxc.pfb
Cronix-Courier-Oblique      Courier-Oblique         croxco.pfb
    ...
      </code></tscreen>
      The font mapping information (Font name &lt;-&gt; Font fall-back) is
      stored in the Grace project files. Provided that all the localized fonts
      have English characters in the lower part of the ascii table unmodified,
      I can send my friend files (with no Hebrew characters, of course) and be
      sure they render correctly on his computer.
      <p>
      Thus, with properly configured national fonts, you can make localized
      annotations for plots intended for internal use of your institution,
      while being able to exchange files with colleagues from abroad. People
      who ever tried to do this with MS Office applications should appreciate
      the flexibility :-).

  <sect1>Interaction with other applications
    <p>

    <sect2>Using pipes
      <p>

    <sect2>Using grace&lowbar;np library
      <p>
      The grace&lowbar;np library is a set of compiled functions that
      allows you to launch and drive a Grace subprocess from your C or
      Fortran application. Functions are provided to start the
      subprocess, to send it commands or data, to stop it or detach
      from it.

      <table LOC=htbp>
      <tabular CA="lll">
        <hline>
        Function           | Arguments          |  Description                 @
        <hline>
        int GraceOpen      | (int <it>buf&lowbar;size</it>)
                                                | launch a Grace subprocess
                                                  and open a communication
                                                  channel with it              @
        int GraceIsOpen    | (void)             | test if a Grace subprocess
                                                  is currently connected       @
        int GraceClose     | (void)             | close the communication
                                                  channel and exit the Grace
                                                  subprocess                   @
        int GraceClosePipe | (void)             | close the communication
                                                  channel and leave the Grace
                                                  subprocess alone             @
        <hline>
        int GraceFlush     | (void)             | flush all the data remaining
                                                  in the buffer                @
        int GracePrintf    | (const char* <it>format</it>, ...)
                                                | format a command and send it
                                                  to the Grace subprocess      @
        int GraceCommand   | (const char* <it>cmd</it>)
                                                | send an already formated
                                                  command to the Grace
                                                  subprocess                   @
        <hline>
        GraceErrorFunctionType <newline> GraceRegisterErrorFunction
                           | (GraceErrorFunctionType <it>f</it>)
                                                | register a user function
                                                  <it>f</it> to display
                                                  library errors               @
        <hline>
      </tabular>
      <caption>
        <label id="C functions"> grace&lowbar;np library C functions.
      </caption>
      </table>

      <table LOC=htbp>
      <tabular CA="lll">
        <hline>
        Function                | Arguments     |  Description                 @
        <hline>
        integer GraceOpenF      | (integer <it>buf&lowbar;size</it>)
                                                | launch a Grace subprocess
                                                  and open a communication
                                                  channel with it              @
        integer GraceIsOpenF    | (void)        | test if a Grace subprocess
                                                  is currently connected       @
        integer GraceCloseF     | (void)        | close the communication
                                                  channel and exit the Grace
                                                  subprocess                   @
        integer GraceClosePipeF | (void)        | close the communication
                                                  channel and leave the Grace
                                                  subprocess alone             @
        <hline>
        integer GraceFlushF     | (void)        | flush all the data remaining
                                                  in the buffer                @
        integer GraceCommandF   | (character*(*) <it>cmd</it>)
                                                | send an already formatted
                                                  command to the Grace
                                                  subprocess                   @
        <hline>
        GraceFortranFunctionType <newline> GraceRegisterErrorFunctionF
                                | (GraceFortranFunctionType <it>f</it>)
                                                | register a user function
                                                  <it>f</it> to display
                                                  library errors               @
        <hline>
      </tabular>
      <caption>
        <label id="fortran functions"> grace&lowbar;np library F77 functions.
      </caption>
      </table>

      <p> There is no fortran equivalent for the GracePrintf function,
      you should format all the data and commands yourself before
      sending them with GraceCommandF.

      The Grace subprocess listen for the commands you send and
      interpret them as if they were given in a batch file. You can
      send any command you like (redraw, autoscale, ...). If you want
      to send data, you should include them in a command like "g0.s0
      point 3.5, 4.2".

      Apart from the fact it monitors the data sent via an anonymous
      pipe, the Grace subprocess is a normal process. You can interact
      with it through the GUI. Note that no error can be sent back to
      the parent process. If your application send erroneous commands,
      an error popup will be displayed by the subprocess.

      If you exit the subprocess while the parent process is still
      using it, the broken pipe will be detected. An error code will
      be returned to every further call to the library (but you can
      still start a new process if you want to manage this situation).

      Here is an example use of the library, you will find this
      program in the distribution.

<tscreen><code>
#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include "grace_np.h"

#ifndef EXIT_SUCCESS
#  define EXIT_SUCCESS 0
#endif

#ifndef EXIT_FAILURE
#  define EXIT_FAILURE -1
#endif

void my_error_function(const char *msg)
{
    fprintf(stderr, "library message: \"%s\"\n", msg);
}

int
main(int argc, char* argv[])
{
    int i;

    GraceRegisterErrorFunction(my_error_function);

    /* Start Grace with a buffer size of 2048 and open the pipe */
    if (GraceOpen(2048) == -1) {
        fprintf(stderr, "Can't run Grace. \n");
        exit(EXIT_FAILURE);
    }
    
    /* Send some initialization commands to Grace */
    GracePrintf("world xmax 100");
    GracePrintf("world ymax 10000");
    GracePrintf("xaxis tick major 20");
    GracePrintf("xaxis tick minor 10");
    GracePrintf("yaxis tick major 2000");
    GracePrintf("yaxis tick minor 1000");
    GracePrintf("s0 on");
    GracePrintf("s0 symbol 1");
    GracePrintf("s0 symbol size 0.3");
    GracePrintf("s0 symbol fill pattern 1");
    GracePrintf("s1 on");
    GracePrintf("s1 symbol 1");
    GracePrintf("s1 symbol size 0.3");
    GracePrintf("s1 symbol fill pattern 1");

    /* Display sample data */
    for (i = 1; i <= 100 && GraceIsOpen(); i++) {
        GracePrintf("g0.s0 point %d, %d", i, i);
        GracePrintf("g0.s1 point %d, %d", i, i * i);
        /* Update the Grace display after every ten steps */
        if (i % 10 == 0) {
            GracePrintf("redraw");
            /* Wait a second, just to simulate some time needed for
               calculations. Your real application shouldn't wait. */
            sleep(1);
        }
    }

    if (GraceIsOpen()) {
        /* Tell Grace to save the data */
        GracePrintf("saveall \"sample.agr\"");

        /* Flush the output buffer and close Grace */
        GraceClose();

        /* We are done */
        exit(EXIT_SUCCESS);
    } else {
        exit(EXIT_FAILURE);
    }
}

</code></tscreen>

 <sect1>FFTW tuning<label id="fftw-tuning">
    <p>
     When the FFTW capabilities are compiled in, Grace looks at two environment
     variables to decide what to do with the FFTW 'wisdom' capabilities. 
     First, a quick summary of what this is. The FFTW package is capable of
     adaptively determining the most efficient factorization of a set to give
     the fastest computation.  It can store these factorizations as 'wisdom',
     so that if a transform of a given size is to be repeated, it is does not
     have to re-adapt.  The good news is that this seems to work very well. 
     The bad news is that, the first time a transform of a given size is
     computed, if it is not a sub-multiple of one already known, it takes a LONG
     time (seconds to minutes).
    <p>
     The first environment variable is GRACE_FFTW_WISDOM_FILE. If this is set
     to the name of a file which can be read and written (e.g.,
     $HOME/.grace_fftw_wisdom) then Grace will automatically create this file
     (if needed) and maintain it. If the file is read-only, it will be read,
     but not updated with new wisdom. If the symbol GRACE_FFTW_WISDOM_FILE
     either doesn't exist, or evaluates to an empty string, Grace will drop the
     use of wisdom, and will use the fftw estimator (FFTW_ESTIMATE flag sent to
     the planner) to guess a good factorization, instead of adaptively
     determining it.
    <p>
     The second variable is GRACE_FFTW_RAM_WISDOM. If this variable is defined
     to be non-zero, and GRACE_FFTW_WISDOM_FILE variable is not defined (or is
     an empty string), Grace will use wisdom internally, but maintain no
     persistent cache of it. This will result in very slow execution times the
     first time a transform is executed after Grace is started, but very fast
     repeats. I am not sure why anyone would want to use wisdom without
     writing it to disk, but if you do, you can use this flag to enable it.
    <p>

  <sect1>DL modules <label id="dl-modules">
    <p>
    Grace can access external functions present
    in either system or third-party shared libraries or modules
    specially compiled for use with Grace.

    <sect2>Function types
    <p>
    One must make sure, however, that the external function is of one
    of supported by Grace types:
      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
      Grace type | Description   @
              <hline>
f&lowbar;of&lowbar;i    | a function of 1 <tt/int/ variable                                 @
f&lowbar;of&lowbar;d    | a function of 1 <tt/double/ variable                              @
f&lowbar;of&lowbar;nn   | a function of 2 <tt/int/ parameters                               @
f&lowbar;of&lowbar;nd   | a function of 1 <tt/int/ parameter and 1 <tt/double/ variable     @
f&lowbar;of&lowbar;dd   | a function of 2 <tt/double/ variables                             @
f&lowbar;of&lowbar;nnd  | a function of 2 <tt/int/ parameters and 1 <tt/double/ variable    @
f&lowbar;of&lowbar;ppd  | a function of 2 <tt/double/ parameters and 1 <tt/double/ variable @
f&lowbar;of&lowbar;pppd | a function of 3 <tt/double/ parameters and 1 <tt/double/ variable @
              <hline>
      </tabular>
      <caption>
              <label id="grace-types">
              Grace types for external functions
      </caption>
      </table>

      The return values of functions are assumed to be of the
      <tt/double/ type.

       Note, that there is no difference from the point of view of
       function prototype between parameters and variables; the
       difference is in the way Grace treats them - an attempt to use
       a vector expression as a parameter argument will result in a
       parse error.

       Let us consider few examples.

       <sect2>Examples
       <p>
       Caution: the examples provided below (paths and compiler flags)
       are valid for Linux/ELF with gcc. On other operating systems,
       you may need to refer to compiler/linker manuals or ask a guru.

       <sect3>Example 1
       <p>
       Suppose I want to use function <tt/pow(x,y)/ from the Un*x math
       library (libm). Of course, you can use the "^" operator defined
       in the Grace language, but here, for the sake of example, we
       want to access the function directly.

       The command to make it accessible by Grace is
       <tscreen>
       USE "pow" TYPE f_of_dd FROM "/usr/lib/libm.so"
       </tscreen>

       Try to plot y = pow(x,2) and y = x^2 graphs (using, for
       example, "create new -&gt; Formula" from any <ref name="set
       selector" id="set-selector">) and compare.

       <sect3>Example 2
       <p>
       Now, let us try to write a function ourselves. We will define
       function <tt/my_function/ which simply returns its (second)
       argument multiplied by integer parameter transferred as the
       first argument.

       In a text editor, type in the following C code and save it as
       "my_func.c":

       <tscreen><code>
       double my_function (int n, double x)
       {
           double retval;
           retval = (double) n * x;
           return (retval);
       }
       </code></tscreen>

       OK, now compile it:

       <tscreen><code>
       $gcc -c -fPIC my_func.c
       $gcc -shared my_func.o -o /tmp/my_func.so
       </code></tscreen>

       (You may strip it to save some disk space):

       <tscreen><code>
       $strip /tmp/my_func.so
       </code></tscreen>

       That's all! Ready to make it visible to Grace as "myf" - we are
       too lazy to type the very long string "my_function" many times.

       <tscreen>
       USE "my_function" TYPE f_of_nd FROM "/tmp/my_func.so" ALIAS "myf"
       </tscreen>


       <sect3>Example 3
       <p>
       A more serious example. There is a special third-party library
       available on your system which includes a very important for
       you yet very difficult-to-program from the scratch function
       that you want to use with Grace.  But, the function prototype
       is NOT one of any predefined <ref name="types"
       id="grace-types">.  The solution is to write a simple function
       wrapper. Here is how:

       Suppose, the name of the library is "special_lib" and the
       function you are interested in is called "special_func" and
       according to the library manual, should be accessed as <tt/void
       special_func(double *input, double *output, int parameter)/.
       The wrapper would look like this:

       <tscreen><code>
       double my_wrapper(int n, double x)
       {
           extern void special_func(double *x, double *y, int n);
           double retval;
           (void) special_func(&amp;x, &amp;retval, n);
           return (retval);
       }
       </code></tscreen>

       Compile it:

       <tscreen><code>
       $gcc -c -fPIC my_wrap.c
       $gcc -shared my_wrap.o -o /tmp/my_wrap.so -lspecial_lib -lblas
       $strip /tmp/my_wrap.so
       </code></tscreen>

       Note that I added <tt/-lblas/ assuming that the special_lib
       library uses some functions from the BLAS. Generally, you have
       to add <it>all</it> libraries which your module depends on (and
       all libraries those libraries rely upon etc.), as if you wanted
       to compile a plain executable.

       Fine, make Grace aware of the new function

       <tscreen>
       USE "my_wrapper" TYPE f_of_nd FROM "/tmp/my_wrap.so" ALIAS "special_func"
       </tscreen>

       so we can use it with its original name.

       <sect3>Example 4
       <p>
       An example of using Fortran modules.

       Here we will try to achieve the same functionality as in
       Example 2, but with the help of F77.

       <tscreen><code>
       DOUBLE PRECISION FUNCTION MYFUNC (N, X)
       IMPLICIT NONE
       INTEGER N
       DOUBLE PRECISION X
C
       MYFUNC = N * X
C
       RETURN
       END
       </code></tscreen>

       As opposite to C, there is no way to call such a function from
       Grace directly - the problem is that in Fortran all arguments
       to a function (or subroutine) are passed by reference. So, we
       need a wrapper:

       <tscreen><code>
       double myfunc_wrapper(int n, double x)
       {
           extern double myfunc_(int *, double *);
           double retval;
           retval = myfunc_(&amp;n, &amp;x);
           return (retval);
       }
       </code></tscreen>

       Note that most of f77 compilers by default add underscore to
       the function names and convert all names to the lower case,
       hence I refer to the Fortran function <tt/MYFUNC/ from my C
       wrapper as <tt/myfunc_/, but in your case it can be different!

       Let us compile the whole stuff:

       <tscreen><code>
       $g77 -c -fPIC myfunc.f
       $gcc -c -fPIC myfunc_wrap.c
       $gcc -shared myfunc.o myfunc_wrap.o -o /tmp/myfunc.so -lf2c -lm
       $strip /tmp/myfunc.so
       </code></tscreen>

       And finally, inform Grace about this new function:

       <tscreen>
       USE "myfunc_wrapper" TYPE f_of_nd FROM "/tmp/myfunc.so" ALIAS "myfunc"
       </tscreen>

       <sect2>Operating system issues
         <p>
         <sect3>OS/2
          <p>
         In general method outlined in the examples above describe can be used
         on OS/2, too. However you have to create a DLL (Dynamic Link Library)
         which is a bit more tricky on OS/2 than on some un*x systems. 
         This document can't explain the whole procedure in detail but roughly
         describe the way to go.
         Since Grace was ported with EMX I also use it to create the examples.
         We refer to Example 2, since Example 1 is showing a problem on OS/2:
         DLLs are likely to have their entry points (i.e. exported functions)
         callable as ordinals only, so you may not know how to access a
         specific function without some research.
         Compile my_func.c to my_func.obj

         <tscreen>
         gcc -Zomf -c my_func.c
         </tscreen>

         Then you need to create a linker definition file my_func.def which
         gives some basic info about the DLL and declares the exported
         functions.

         <tscreen><code>
         LIBRARY my_func
         INITINSTANCE TERMINSTANCE
         CODE LOADONCALL
         DATA LOADONCALL MULTIPLE NONSHARED
         DESCRIPTION 'This is a test DLL: my_func.dll'
         EXPORTS
         my_function
         </code></tscreen>

         (don't forget about the 8 characters limit on the DLL name!).
         Finally link the DLL:

         <tscreen>
         gcc my_func.obj my_func.def -o my_func.dll -Zdll -Zno-rte -Zomf
         </tscreen>

         (the -Zno-rte flag depends on the content of the library;
          check out the EMX documentation when you may use it)
         To make use of the function in Grace you may either put the
         DLL in the LIBPATH and use the short form:

         <tscreen>
         USE "my_function" TYPE f_of_nd FROM "my_func" ALIAS "myf"
         </tscreen>

         or have it in an arbitrary path which you need to specify explicitly
         then:

         <tscreen>
         USE "my_function" TYPE f_of_nd FROM "e:/foo/my_func.dll" ALIAS "myf"
         </tscreen>

<!-- ****** Appendices/references ************ -->
<sect> References
  <p>
  
  <sect1>Typesetting<label id="typesetting">
    <p>
      Grace permits quite complex typesetting on a per string basis.
      Any string displayed (titles, legends, tick marks,...) may contain
      special control codes to display subscripts, change fonts within the
      string etc.
       <p>

      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Control code | Description   @
              <hline>
              &bsol;f{x}   | switch to font named "x"   @
              &bsol;f{n}   | switch to font number n    @
              &bsol;f{}    | return to original font    @
              &bsol;R{x}   | switch to color named "x"  @
              &bsol;R{n}   | switch to color number n   @
              &bsol;R{}    | return to original color   @
              &bsol;#{x}   | treat "x" (must be of even length) as list of hexadecimal char codes @
              &bsol;t{xx xy yx yy} | apply transformation matrix   @
              &bsol;t{}    | reset transformation matrix   @
              &bsol;z{x}   | zoom x times   @
              &bsol;z{}    | return to original zoom   @
              &bsol;r{x}   | rotate by x degrees   @
              &bsol;l{x}   | slant by factor x   @
              &bsol;v{x}   | shift vertically by x   @
              &bsol;v{}    | return to unshifted baseline   @
              &bsol;h{x}   | horizontal shift by x   @
              &bsol;u      | begin underline   @
              &bsol;U      | stop underline   @
              &bsol;o      | begin overline   @
              &bsol;O      | stop overline   @
              &bsol;Fk     | enable kerning   @
              &bsol;FK     | disable kerning   @
              &bsol;Fl     | enable ligatures   @
              &bsol;FL     | disable ligatures   @
              &bsol;m{n}   | mark current position as n   @
              &bsol;M{n}   | return to saved position n   @
              &bsol;dl     | LtoR substring direction   @
              &bsol;dr     | RtoL substring direction   @
              &bsol;dL     | LtoR text advancing   @
              &bsol;dR     | RtoL text advancing   @
              <hline>
              &bsol;x      | switch to Symbol font (same as &bsol;f{Symbol})   @
              &bsol;+      | increase size (same as &bsol;z{1.19} ; 1.19 = sqrt(sqrt(2)))   @
              &bsol;-      | decrease size (same as &bsol;z{0.84} ; 0.84 = 1/sqrt(sqrt(2)))   @
              &bsol;s      | begin subscripting (same as &bsol;v{-0.4}&bsol;z{0.71})   @
              &bsol;S      | begin superscripting (same as &bsol;v{0.6}&bsol;z{0.71})   @
              &bsol;T{xx xy yx yy} | same as &bsol;t{}&bsol;t{xx xy yx yy}   @
              &bsol;Z{x}   | absolute zoom x times (same as &bsol;z{}&bsol;z{x})  @
              &bsol;q      | make font oblique (same as &bsol;l{0.25})   @
              &bsol;Q      | undo oblique (same as &bsol;l{-0.25})   @
              &bsol;N      | return to normal style (same as &bsol;v{}&bsol;t{})   @
              <hline>
              &bsol;&bsol; | print &bsol;   @
              <hline>
              &bsol;n      | switch to font number n (0-9) (deprecated) @
              &bsol;c      | begin using upper 128 characters of set (deprecated)  @
              &bsol;C      | stop using upper 128 characters of set (deprecated)  @
              <hline>
      </tabular>
      <caption>
              <label id="control-codes">
              Control codes.
      </caption>
      </table>

      <p>
       Example:
      <p>
       F&bsol;sX&bsol;N(&bsol;xe&bsol;f{}) = sin(&bsol;xe&bsol;B)&bsol;c7&bsol;Ce&bsol;S-X&bsol;N&bsol;c7&bsol;Ccos(&bsol;xe&bsol;f{})
      <p>
       prints roughly
       <tscreen><verb>
                       -x
       F (e) = sin(e)&middot;e  &middot;cos(e)
        x
       </verb></tscreen>
      <p>
       using string's initial font and e prints as epsilon from the Symbol font.
      <p>
       NOTE:
       Characters from the upper half of the char table can be entered directly
       from the keyboard, using appropriate <tt>xmodmap(1)</tt> settings, or
       with the help of the font tool ("Window/Font tool").
      <p>

  <sect1>Device-specific limitations<label id="device-limitations">
    <p>
      
      Grace can output plots using several device backends. The list of
      available devices can be seen (among other stuff) by specifying the
      "-version" command line switch.
      <itemize>
        <item> X11, PostScript and EPS are full-featured devices
        <item> Raster drivers (PNM/JPEG/PNG):
               <itemize>
                 <item> only even-odd fill rule is supported
                 <item> patterned lines are not implemented
               </itemize>
        <item> PDF driver:
               <itemize>
                 <item> patterned fills are not implemented
                 <item> bitmapped text strings are not transparent
                 <item> arcs of angles != 90*n are approximated very roughly
               </itemize>
        <item> MIF driver:
               the driver is a brand new one and still in alpha test
        <item> SVG driver:
               the driver is a brand new one and still in alpha test, one
               should also be aware that SVG is still a W3C working draft,
               not yet a recommendation (see the <url
               url="http://www.w3.org/TR/1999/12/WD-SVG-19991203/"
               name="Scalable Vector Graphics (SVG) 1.0 Specification">)
      </itemize>
      
      <p>

  <sect1>Device-specific settings<label id="device-settings">
    <p>
      
      Some of the output devices accept several configuration options. You can
      set the options by passing a respective string to the interpreter
      using the "DEVICE <it/"devname"/ OP <it/"options"/" command (see
      <ref id="device-parameters" name="Device parameters">). A few options
      can be passed in one command, separated by commas.

    <p>
      
      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command           | Description                               @
              <hline>
              grayscale         | set grayscale output                      @
              color             | set color output                          @
              level1            | use only PS Level 1 subset of commands    @
              level2            | use also PS Level 2 commands if needed    @
              xoffset:<it/x/    | set page offset in X direction <it/x/ pp  @
              yoffset:<it/y/    | set page offset in Y direction <it/y/ pp  @
              <hline>
      </tabular>
      <caption>
              PostScript driver options
      </caption>
      </table>

    <p>
      
      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command       | Description                                   @
              <hline>
              grayscale     | set grayscale output                          @
              color         | set color output                              @
              level1        | use only PS Level 1 subset of commands        @
              level2        | use also PS Level 2 commands if needed        @
              bbox:tight    | enable "tight" bounding box                   @
              bbox:page     | bounding box coincides with page dimensions   @
              <hline>
      </tabular>
      <caption>
              EPS driver options
      </caption>
      </table>

    <p>

      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command           | Description                        @
              <hline>
              PDF1.2            | set compatibility mode to PDF-1.2  @
              PDF1.3            | set compatibility mode to PDF-1.3  @
              compression:value | set compression level (0 - 9)      @
              <hline>
      </tabular>
      <caption>
              PDF driver options
      </caption>
      </table>

    <p>

      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command           | Description               @
              <hline>
              format:pbm        | output in PBM format      @
              format:pgm        | output in PGM format      @
              format:ppm        | output in PPM format      @          
              rawbits:on        | "rawbits" (binary) output @          
              rawbits:off       | ASCII output              @          
              <hline>
      </tabular>
      <caption>
              PNM driver options
      </caption>
      </table>

    <p>

      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command               | Description                           @
              <hline>
              grayscale             | set grayscale output                  @
              color                 | set color output                      @
              optimize:on/off       | enable/disable optimization           @
              quality:value         | set compression quality (0 - 100)     @
              smoothing:value       | set smoothing (0 - 100)               @
              baseline:on/off       | do/don't force baseline output        @
              progressive:on/off    | do/don't output in progressive format @
              dct:ifast             | use fast integer DCT method           @
              dct:islow             | use slow integer DCT method           @
              dct:float             | use floating-point DCT method         @
              <hline>
      </tabular>
      <caption>
              JPEG driver options
      </caption>
      </table>

    <p>

      <table LOC=htbp>
      <tabular CA="ll">
              <hline>
              Command           | Description                       @
              <hline>
              interlaced:on     | make interlaced image             @
              interlaced:off    | don't make interlaced image       @
              transparent:on    | produce transparent image         @
              transparent:off   | don't produce transparent image   @
              compression:value | set compression level (0 - 9)     @
              <hline>
      </tabular>
      <caption>
              PNG driver options
      </caption>
      </table>

    <p>


    <sect1>Dates in Grace <label id="dates">
    
    <p>
      We use two calendars in Grace: the one that was established in
      532 by Denys and lasted until 1582, and the one that was created
      by Luigi Lilio (Alyosius Lilius) and Christoph Klau
      (Christophorus Clavius) for pope Gregorius XIII. Both use the
      same months (they were introduced under emperor Augustus, a few
      years after Julian calendar introduction, both Julius and
      Augustus were honored by a month being named after each one).
      
      The leap years occurred regularly in Denys's calendar: once
      every four years, there is no year 0 in this calendar (the leap
      year -1 was just before year 1). This calendar was not compliant
      with earth motion and the dates were slowly shifting with regard
      to astronomical events.
      
      This was corrected in 1582 by introducing Gregorian
      calendar. First a ten days shift was introduced to reset correct
      dates (Thursday October the 4th was followed by Friday October
      the 15th). The rules for leap years were also changed: three
      leap years are removed every four centuries. These years are
      those that are multiple of 100 but not multiple of 400: 1700,
      1800, and 1900 were not leap years, but 1600 and 2000 were (will
      be) leap years.
      
      We still use Gregorian calendar today, but we now have several
      time scales for increased accuracy. The International Atomic
      Time (TAI) is a linear scale: the best scale to use for
      scientific reference. The Coordinated Universal Time (UTC, often
      confused with Greenwich Mean Time) is a legal time that is
      almost synchronized with earth motion. However, since the earth
      is slightly slowing down, leap seconds are introduced from time
      to time in UTC (about one second every 18 months). UTC is not a
      continuous scale ! When a leap second is introduced by
      International Earth Rotation Service, this is published in
      advance and the legal time sequence is as follows: 23:59:59
      followed one second later by 23:59:60 followed one second later
      by 00:00:00. At the time of this writing (1999-01-05) the
      difference between TAI and UTC was 32 seconds, and the last leap
      second was introduced in 1998-12-31.
      
      These calendars allow to represent any date from the mist of the
      past to the fog of the future, but they are not convenient for
      computation. Another time scale is possible: counting only the
      days from a reference. Such a time scale was introduced by
      Joseph-Juste Scaliger (Josephus Justus Scaliger) in 1583. He
      decided to use "-4713-01-01T12:00:00" as a reference date
      because it was at the same time a Monday, first of January of a
      leap year, there was an exact number of 19 years Meton cycle
      between this date and year 1 (for Easter computation), and it
      was at the beginning of a 15 years <it>Roman indiction</it>
      cycle. The day number counted from this reference is
      traditionally called <it>Julian day</it>, but it has really
      nothing to do with the Julian calendar.

      Grace stores dates internally as reals numbers counted from a
      reference date. The default reference date is the one chosen by
      Scaliger, it is a classical reference for astronomical
      events. It can modified for a single session using the <ref
      name="Edit-&gt;Preferences" id="preferences"> popup of the GUI. If
      you often work with a specific reference date you can set it for
      every sessions with a REFERENCE DATE command in your
      configuration file (see <ref name="Default template"
      id="default-template">).
      
      The following date formats are supported (hour, minutes and
      seconds are always optional):
      
      <enum>
      <item>iso8601  : 1999-12-31T23:59:59.999
      <item>european : 31/12/1999 23:59:59.999 or 31/12/99 23:59:59.999
      <item>us       : 12/31/1999 23:59:59.999 or 12/31/99 23:59:59.999
      <item>Julian   : 123456.789
      </enum>
      
      One should be aware that Grace does not allow to put a space in
      one data column as spaces are used to separate fields. You
      should always use another separator (:/.- or better T) between
      date and time in data files. The GUI, the batch language and the
      command line flags do not have this limitation, you can use
      spaces there without any problem. The T separator comes from the
      ISO8601 standard. Grace support its use also in european and us
      formats.

      You can also provide a hint about the format ("ISO8601",
      "european", "us") using the -datehint command line flag or the
      ref name="Edit->Preferences" id="preferences"> popup of the GUI.
      The formats are tried in the following order: first the hint
      given by the user, then iso, european and us (there is no
      ambiguity between calendar formats and numerical formats and
      therefore no order is specified for them). The separators
      between various fields can be any characters in the set: " :/.-T"
      (one or more spaces act as one separator, other characters can
      not be repeated, the T separator is allowed only between date and time,
      mainly for iso8601), so the string "1999-12 31:23/59" is allowed
      (but not recommended).  The '-' character is used both as a
      separator (it is traditionally used in iso8601 format) and as
      the unary minus (for dates in the far past or for numerical
      dates). By default years are left untouched, so 99 is a date far
      away in the past. This behavior can be changed with the <ref
      name="Edit->preferences" id="preferences"> popup, or with the
      <tt>DATE WRAP on</tt> and <tt>DATE WRAP YEAR year</tt>
      commands. Suppose for example that the wrap year is chosen as
      1950, if the year is between 0 and 99 and is written with two or
      less digits, it is mapped to the present era as follows:

       range [00 ; 49] is mapped to [2000 ; 2049]

       range [50 ; 99] is mapped to [1950 ; 1999]

      with a wrap year set to 1970, the mapping would have been:

       range [00 ; 69] is mapped to [2000 ; 2069]

       range [70 ; 99] is mapped to [1970 ; 1999]

      this is reasonably Y2K compliant and is consistent with current
      use.  Specifying year 1 is still possible using more than two
      digits as follows: "0001-03-04" is unambiguously March the 4th,
      year 1. The inverse transform is applied for dates written by
      Grace, for example as tick labels. Using two digits only for
      years is not recommended, we introduce a <it>wrap year +
      100</it> bug here so this feature should be removed at some
      point in the future ...
      
      The date scanner can be used either for Denys's and Gregorian
      calendars. Inexistent dates are detected, they include year 0,
      dates between 1582-10-05 and 1582-10-14, February 29th of non
      leap years, months below 1 or above 12, ...  the scanner does
      not take into account leap seconds: you can think it works only
      in International Atomic Time (TAI) and not in Coordinated
      Unified Time (UTC). If you find yourself in a situation were you
      need UTC, a very precise scale, and should take into account
      leap seconds ... you should convert your data yourself (for
      example using International Atomic Time). But if you bother with
      that you probably already know what to do.


    <sect1>Xmgr to Grace migration guide
    
    <p>
      
      This is a very brief guide describing problems and workarounds for
      reading in project files saved with Xmgr. You should read the docs or
      just play with Grace to test new features and controls.
 
      <enum>
      <item> Grace must be explicitly told the version number of the software
             used to create a file. You can manually put "@version VERSIONID"
             string at the beginning of the file. The VERSIONID is built as
             MAJOR_REV*10000 + MINOR_REV*100 + PATCHLEVEL; so 40101 corresponds
             to xmgr-4.1.1. Projects saved with Xmgr-4.1.2 do NOT need the above,
             since they already have the version string in them. If you have no
             idea what version of Xmgr your file was created with, try some.
             In most cases, 40102 would do the trick.
 
      <item> The above relates to the ASCII projects only. The old binary
             projects (saved with xmgr-4.0.*) are not automatically converted
             anymore. An input filter must be defined to make the conversion
             work on-the-fly. Add the following line to ~/.gracerc or the
             system-wide $GRACE_HOME/gracerc resource file: DEFINE IFILTER
             "grconvert %s -" MAGIC "00000031" See docs for more info on the
             I/O filters.
 
      <item> Documentation on the script language is severely lacking still.
 
      <item> Grace is WYSIWYG. Xmgr was not. Many changes required to achieve the
             WYSIWYG'ness led to the situation when graphs with objects carefully
             aligned under Xmgr may not look so under Grace. Grace tries its best
             to compensate for the differences, but sometimes you may have to
             adjust such graphs manually.
 
      <item> A lot of symbol types (all except *real* symbols) are removed.
             "Location *" types can be replaced (with much higher comfort) by
             A(nnotating)values. "Impulse *", "Histogram *" and "Stair steps *"
             effects can be achieved using the connecting line parameters (Type,
             Drop lines). "Dot" symbol is removed as well; use the filled circle
             symbol of the zero size with no outline to get the same effect.
 
      <item> Default page layout switched from free (allowing to resize canvas
             with mouse) to fixed. For the old behavior, put "PAGE LAYOUT FREE"
             in the Grace resource file or use the "-free" command line switch.
             <bf>The use of the "free" page layout is in general deprecated,
             though.</bf>
 
      <item> System (shell) variables GR_* renamed to GRACE_*
 
      <item> Smith plots don't work now. They'll be put back soon.
 
      </enum>
    

</article>

<!-- End of USerGuide.sgml -->
